{# app/templates/partials/_nav.html #}
<header class="header">
  <div class="container header__inner">
    <a class="brand" href="{{ url_for('routes.index') }}">
      <span class="brand__dot" aria-hidden="true"></span>
      <span>{{ APP_TITLE or "Мониторинг спортсменов" }}</span>
    </a>

    {# staff = admin/doctor/coach/operator #}
    {% set is_staff = (
      current_user.is_authenticated
      and (current_user.has_role('admin', 'doctor', 'coach', 'operator') if current_user.has_role is defined else false)
      and (current_user.is_active if current_user.is_active is defined else true)
    ) %}

    <nav class="nav" aria-label="Навигация">
      {# ПУБЛИЧНО: доступно гостю #}
      <a href="{{ url_for('routes.index') }}"
         class="{% if request.endpoint == 'routes.index' %}is-active{% endif %}">
        Дашборд
      </a>

      <a href="{{ url_for('feedback.feedback_home') }}"
         class="{% if request.endpoint and request.endpoint.startswith('feedback.') %}is-active{% endif %}">
        Обращения
      </a>

      <a href="{{ url_for('routes.about') }}"
         class="{% if request.endpoint == 'routes.about' %}is-active{% endif %}">
        О системе
      </a>

      <a href="{{ url_for('routes.contacts') }}"
         class="{% if request.endpoint == 'routes.contacts' %}is-active{% endif %}">
        Контакты
      </a>

      {# ТОЛЬКО STAFF: не показываем гостю и обычному user #}
      {% if is_staff %}
        <a href="{{ url_for('routes.catalog') }}"
           class="{% if request.endpoint == 'routes.catalog' %}is-active{% endif %}">
          Журнал
        </a>

        <a href="{{ url_for('routes.offers') }}"
           class="{% if request.endpoint == 'routes.offers' %}is-active{% endif %}">
          Отклонения
        </a>

        <a href="{{ url_for('routes.categories') }}"
           class="{% if request.endpoint == 'routes.categories' %}is-active{% endif %}">
          Показатели
        </a>

        <a href="{{ url_for('routes.search') }}"
           class="{% if request.endpoint == 'routes.search' %}is-active{% endif %}">
          Поиск
        </a>
      {% endif %}

      {# Авторизованным: кабинет (и админка только staff) #}
      {% if current_user.is_authenticated %}
        <a href="{{ url_for('cabinet.cabinet_home') }}"
           class="{% if request.endpoint and request.endpoint.startswith('cabinet.') %}is-active{% endif %}">
          Кабинет
        </a>

        {% if is_staff %}
          <a href="{{ url_for('admin.dashboard') }}"
             class="{% if request.endpoint and request.endpoint.startswith('admin.') %}is-active{% endif %}">
            Админка
          </a>
        {% endif %}
      {% endif %}
    </nav>

    <div class="row">
      {% if current_user.is_authenticated %}
        <span class="badge" data-tip="Роль: {{ current_user.role }}">
          {{ current_user.username }}
        </span>
        <a class="btn btn--ghost" href="{{ url_for('auth.logout') }}">Выход</a>
      {% else %}
        <a class="btn" href="{{ url_for('auth.login') }}">Вход</a>
        <a class="btn btn--primary" href="{{ url_for('auth.register') }}">Регистрация</a>
      {% endif %}
    </div>
  </div>
</header>
