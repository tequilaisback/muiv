{# app/templates/search.html #}
{% extends "base.html" %}

{% block title %}Поиск{% endblock %}

{% block content %}
  <div class="card section">
    <div class="row">
      <h1 style="margin:0;">Поиск</h1>
      <form id="searchForm" class="right row" method="get" action="{{ url_for('main.search') }}">
        <input id="searchInput" class="input" style="width:320px;" name="q" value="{{ q or '' }}" placeholder="Введите название товара">
        <button class="btn btn-small" type="submit">Искать</button>
        <a class="btn btn-small" href="{{ url_for('main.search') }}">Сброс</a>
      </form>
    </div>

    <p class="lead" style="margin-top:10px;">
      Поиск выполняется по названию товара (LIKE/ilike).
    </p>
  </div>

  {% if q %}
    {% if products %}
      <div class="card section">
        <h2>Результаты</h2>
        <p class="product-meta" style="margin:0;">
          Найдено: <b>{{ products|length }}</b> · запрос: <b>{{ q }}</b>
        </p>
      </div>

      <div class="grid" style="margin-top:14px;">
        {% for p in products %}
          <a class="product-card" href="{{ url_for('main.product_detail', product_id=p.id) }}">
            <div class="product-thumb">
              {% if p.discount_percent and p.discount_percent > 0 %}
                <span class="badge badge-sale">-{{ p.discount_percent }}%</span>
              {% endif %}
              <div class="product-meta" style="padding:0 12px;text-align:center;">
                {% if p.image_filename %}{{ p.image_filename }}{% else %}Нет изображения{% endif %}
              </div>
            </div>

            <div class="product-body">
              <p class="product-title">{{ p.name }}</p>
              <p class="product-meta">Категория: {{ p.category.name if p.category else "-" }}</p>

              <div class="price">
                {% if p.discount_percent and p.discount_percent > 0 %}
                  <span class="price-now">{{ "%.2f"|format(p.final_price) }} ₽</span>
                  <span class="price-old">{{ "%.2f"|format(p.price_value) }} ₽</span>
                {% else %}
                  <span class="price-now">{{ "%.2f"|format(p.price_value) }} ₽</span>
                {% endif %}
              </div>

              <div class="row">
                <span class="btn btn-small">Открыть</span>
              </div>
            </div>
          </a>
        {% endfor %}
      </div>
    {% else %}
      <div class="card section">
        <h2>Результаты</h2>
        <p class="lead" style="margin:0;">
          По запросу <b>{{ q }}</b> ничего не найдено.
        </p>
        <div class="row" style="margin-top:12px;">
          <a class="btn btn-primary" href="{{ url_for('main.catalog') }}">Перейти в каталог</a>
          <a class="btn" href="{{ url_for('main.offers') }}">Посмотреть акции</a>
        </div>
      </div>
    {% endif %}
  {% else %}
    <div class="card section">
      <h2>Как искать</h2>
      <p class="lead" style="margin:0;">
        Введите часть названия товара и нажмите «Искать».
      </p>
      <div class="row" style="margin-top:12px;">
        <a class="btn btn-primary" href="{{ url_for('main.catalog') }}">Открыть каталог</a>
      </div>
    </div>
  {% endif %}
{% endblock %}
