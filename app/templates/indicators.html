{# app/templates/categories.html #}
{% extends "base.html" %}

{% block title %}Показатели и нормы — {{ APP_TITLE }}{% endblock %}

{% block content %}
  <div class="row space-between">
    <div>
      <h1 class="card__title" style="margin:0;">Показатели и нормы</h1>
      <p class="card__subtitle" style="margin:6px 0 0;">
        Справочник показателей, единицы измерения и диапазоны нормы (min/max).
      </p>
    </div>
    <div class="row">
      {% if is_admin or is_operator %}
        <a class="btn btn--primary" href="{{ url_for('admin.indicators') }}">Управление</a>
      {% endif %}
      <a class="btn" href="{{ url_for('routes.search') }}">Поиск</a>
    </div>
  </div>

  <div class="grid grid--2 mt-16">
    <div class="card">
      <div class="card__body">
        <h2 class="card__title">Категории</h2>
        <p class="card__subtitle">Группировка показателей (допускается иерархия).</p>

        {% if categories and categories|length > 0 %}
          <table class="table mt-12">
            <thead>
              <tr>
                <th>Категория</th>
                <th>Родитель</th>
              </tr>
            </thead>
            <tbody>
              {% for c in categories %}
                <tr>
                  <td><b>{{ c.name }}</b></td>
                  <td>{{ c.parent.name if c.parent else "—" }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% else %}
          <p class="mt-12" style="margin:0; color: var(--muted);">
            Категории пока не заполнены.
          </p>
        {% endif %}
      </div>
    </div>

    <div class="card">
      <div class="card__body">
        <h2 class="card__title">Показатели</h2>
        <p class="card__subtitle">Список активных показателей, нормы и единицы.</p>

        {% if indicators and indicators|length > 0 %}
          <table class="table mt-12">
            <thead>
              <tr>
                <th>Показатель</th>
                <th>Категория</th>
                <th>Ед.</th>
                <th>Норма</th>
              </tr>
            </thead>
            <tbody>
              {% for i in indicators %}
                <tr>
                  <td><b>{{ i.name }}</b></td>
                  <td>{{ i.category.name if i.category else "—" }}</td>
                  <td>{{ i.unit or "—" }}</td>
                  <td>
                    {% if i.norm_min is not none or i.norm_max is not none %}
                      {{ i.norm_min if i.norm_min is not none else "—" }} — {{ i.norm_max if i.norm_max is not none else "—" }}
                    {% else %}
                      —
                    {% endif %}
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% else %}
          <p class="mt-12" style="margin:0; color: var(--muted);">
            Показатели пока не заполнены.
          </p>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="card mt-16">
    <div class="card__body">
      <h2 class="card__title">Как интерпретируется “норма”</h2>
      <p class="card__subtitle" style="margin-top:10px;">
        Если для показателя задан диапазон <b>min–max</b>, то измерение считается отклонением,
        когда значение меньше min или больше max. В интерфейсе такие записи выделяются красным.
      </p>
    </div>
  </div>
{% endblock %}
